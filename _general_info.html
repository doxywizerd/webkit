<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>webkit: General Information</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">webkit
   &#160;<span id="projectnumber">2cdf99a9e3038c7e01b3c37e8ad903ecbe5eecf1</span>
   </div>
   <div id="projectbrief">https://github.com/WebKit/webkit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">General Information </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="protocol_the-p.html">The</a> following information is applicable to two or more interfaces.</p>
<p><a class="el" href="_general_info.html#_errors">Error Handling</a><br />
<a class="el" href="_general_info.html#_memory">Memory Management</a><br />
&#160;&#160;<a class="el" href="_general_info.html#_arrayConsideration">Special Consideration when using Arrays</a><br />
<a class="el" href="_general_info.html#_indexes">Zero and One Based Indexes</a><br />
<a class="el" href="_general_info.html#_enums">Enums</a><br />
<a class="el" href="_general_info.html#_specialOffsets">Special Offsets for use in the IAccessibleText and IAccessibleEditableText Methods</a><br />
<a class="el" href="_general_info.html#_dicoveringInterfaces">Discovery of Interfaces</a><br />
<a class="el" href="_general_info.html#_changingInterfaces">Changing between Accessible Interfaces</a><br />
<a class="el" href="_general_info.html#_applicationInfo">Access to Information about the Application</a><br />
<a class="el" href="_general_info.html#_childIDs">Child IDs</a><br />
<a class="el" href="_general_info.html#_variants">VARIANTs</a><br />
<a class="el" href="_general_info.html#_iaaction-iahyperlink">IAccessibleHyperlink as subclass of IAccessibleAction</a><br />
<a class="el" href="_general_info.html#_trademark">Trademark Attribution</a></p>
<h1><a class="anchor" id="_errors"></a>
Error Handling</h1>
<p>HRESULT values are defined by the Microsoft&reg; Win32&reg; <a class="el" href="namespace_a_p_i.html">API</a>. For more information, refer to <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa378137%28v=vs.85%29.aspx">Interpreting HRESULT Values</a> in MSDN&reg;.</p>
<p>Note that the S_FALSE return value is considered a non-error value and the SUCCEEDED macro will return TRUE. S_FALSE is used when there is no failure but there was nothing valid to return, e.g. in <a class="el" href="interface_i_accessible2.html#a3977a6522effed291ffcccd00d8d507f" title="Returns the attributes specific to this object, such as a cell&#39;s formula. ">IAccessible2::attributes</a> when there are no attributes. When S_FALSE is returned [out] pointer types should be NULL and [out] longs should generally be 0, but sometimes -1 is used such as <a class="el" href="interface_i_accessible2.html#a25f81ed8c8ed50a8db0c2b9d26688dfb" title="Returns the index of this object in its parent object. ">IAccessible2::indexInParent</a>, <a class="el" href="interface_i_accessible_text.html#ae1fd3dc5fa10e0d45570b3cffa8011f1" title="Returns the position of the caret. ">IAccessibleText::caretOffset</a>, and IAccessibleHypertext::hyperlinkIndex.</p>
<p>Note that for BSTR [out] variables common COM practice is that the server does the SysAllocString and the client does the SysFreeString. Also note that when NULL is returned there is no need for the client to call SysFreeString. Please refer to the documentation for each method for more details regarding error handling.</p>
<h1><a class="anchor" id="_memory"></a>
Memory Management</h1>
<p><a class="el" href="protocol_the-p.html">The</a> following memory management issues should be considered: </p><ul>
<li>Although [out] BSTR variables are declared by the client, their space is allocated by the server. They need to be freed with SysFreeString by the client at end of life; the same is true when BSTRs are used in structs or arrays which are passed to the server. </li>
<li>If there is no valid [out] BSTR to return, the server should return S_FALSE and assign NULL to the output, e.g. *theOutBSTR = NULL;. </li>
<li>COM interfaces need to be referenced with AddRef when used and dereferenced with Release at end of life. </li>
<li>Single [out] longs, HWNDs, booleans, and structs are declared by the caller and passed by reference. <a class="el" href="protocol_the-p.html">The</a> marshaller does all the memory management.</li>
</ul>
<p><a class="el" href="protocol_the-p.html">The</a> following articles may be helpful for understanding memory management issues: </p><ul>
<li>An article by Don Box in a <a href="http://www.microsoft.com/msj/1196/activex1196.aspx">Q &amp; A section</a> of the November 1996 edition of the Microsoft Systems Journal. </li>
<li><a class="el" href="struct_a.html">A</a> posting to a CodeGuru forum, <a href="http://www.codeguru.com/forum/showthread.php?t=364511">Windows SDK String: What are the rules for BSTR allocation and deallocation?</a></li>
</ul>
<h2><a class="anchor" id="_arrayConsideration"></a>
Special Consideration when using Arrays</h2>
<p>There are several methods which return arrays. In the case of <a class="el" href="interface_i_accessible2.html#ac9d1889f7dc67248a315b7982c336082" title="Returns multiple accessible relations for this object. ">IAccessible2::relations</a> and <a class="el" href="interface_i_accessible_relation.html#a1b71705e44917416000e4b500fdb4113" title="Returns multiple accessible relation targets. ">IAccessibleRelation::targets</a> the client must allocate and free the arrays.</p>
<p>For the remaining methods which return arrays, the server must allocate the array and the client must free the array when no longer needed. These methods are <a class="el" href="interface_i_accessible2.html#ab2654fe2b944e03dd4eb4d56e008d82d" title="Returns the extended states (array of strings). ">IAccessible2::extendedStates</a>, <a class="el" href="interface_i_accessible2.html#a13dc28afcaea363527e58049292149d9" title="Returns the localized extended states (array of strings). ">IAccessible2::localizedExtendedStates</a>, <a class="el" href="interface_i_accessible2__2.html#a4e0d41b00e6b3714ecef3c75ad2ac428" title="Returns relation targets for a specified target type. ">IAccessible2_2::relationTargetsOfType</a>, IAccessibleAction::keyBinding, IAccessibleHypertext2::hyperlinks, IAccessibleTable::selectedChildren, IAccessibleTable::selectedColumns, IAccessibleTable::selectedRows, IAccessibleTable2::selectedCells, IAccessibleTable2::selectedColumns, IAccessibleTable2::selectedRows, IAccessibleTableCell::columnHeaderCells, and IAccessibleTableCell::rowHeaderCells. For those methods, the server must allocate both the top level array and any storage associated with it, e.g. for BSTRs. <a class="el" href="protocol_the-p.html">The</a> server must allocate the arrays with CoTaskMemAlloc and any BSTRs with SysAllocString. <a class="el" href="protocol_the-p.html">The</a> client must use CoTaskMemFree to free the array and any BSTRs must be freed with SysFreeString.</p>
<p>Also, the IDL for <a class="el" href="interface_i_accessible2.html#ab2654fe2b944e03dd4eb4d56e008d82d" title="Returns the extended states (array of strings). ">IAccessible2::extendedStates</a>, <a class="el" href="interface_i_accessible2.html#a13dc28afcaea363527e58049292149d9" title="Returns the localized extended states (array of strings). ">IAccessible2::localizedExtendedStates</a>, IAccessibleAction::keyBinding, IAccessibleTable::selectedChildren, IAccessibleTable::selectedColumns, and IAccessibleTable::selectedRows includes an extraneous [in] parameter for the caller to specify the max size of the array. This parameter will be ignored by the COM server.</p>
<h1><a class="anchor" id="_indexes"></a>
Zero and One Based Indexes</h1>
<p>Unless otherwise specified all offsets and indexes are 0 based.</p>
<h1><a class="anchor" id="_enums"></a>
Enums</h1>
<p>Note that enums start at 0.</p>
<h1><a class="anchor" id="_specialOffsets"></a>
Special Offsets for use in the IAccessibleText and IAccessibleEditableText Methods</h1>
<p><a class="el" href="interface_i_accessible_text.html" title="This interface gives read-only access to text. ">IAccessibleText</a> and <a class="el" href="interface_i_accessible_editable_text.html" title="This interface provides clipboard capability to text objects. ">IAccessibleEditableText</a> can use one or more of the following special offset values. They are defined in the <a class="el" href="_i_a2_common_types_8idl.html#ad6b061c25f6d413ee969a0ab9b662088">IA2TextSpecialOffsets</a> enum. </p><ul>
<li>Using <a class="el" href="_i_a2_common_types_8idl.html#ad6b061c25f6d413ee969a0ab9b662088a692fd456068048d8ee0f13d391285d6d">IA2_TEXT_OFFSET_LENGTH</a> (-1) as an offset in any of the <a class="el" href="interface_i_accessible_text.html" title="This interface gives read-only access to text. ">IAccessibleText</a> or <a class="el" href="interface_i_accessible_editable_text.html" title="This interface provides clipboard capability to text objects. ">IAccessibleEditableText</a> methods is the same as specifying the length of the string. </li>
<li>Using <a class="el" href="_i_a2_common_types_8idl.html#ad6b061c25f6d413ee969a0ab9b662088a7e181e843940f5f7f336e3cc2394dfb9">IA2_TEXT_OFFSET_CARET</a> (-2) as an offset for <a class="el" href="interface_i_accessible_text.html#a9d934e177b6c757e692f55a24725e778" title="Returns a text portion before the given position. ">IAccessibleText::textBeforeOffset</a>, <a class="el" href="interface_i_accessible_text.html#a5e040bbb2f5444f68cfb6419430918e3" title="Returns a text portion that spans the given position. ">IAccessibleText::textAtOffset</a>, and <a class="el" href="interface_i_accessible_text.html#ae115b7214baac4d307b7b4b7ec981b9a" title="Returns a text portion after the given position. ">IAccessibleText::textAfterOffset</a> indicates that the text related to the physical location of the caret should be used. This is needed for applications that consider the character offset of the end of one line (as reached by pressing the End key) the same as the offset of the first character on the next line. Since the same offset is associated with two different lines a special means is needed to fetch text from the line where the caret is physically located.</li>
</ul>
<h1><a class="anchor" id="_dicoveringInterfaces"></a>
Discovery of Interfaces</h1>
<p>In general AT (Assistive Technology) should try <a class="el" href="interface_i_accessible2.html" title="This interface exposes the primary set of information about an IAccessible2 enabled accessible object...">IAccessible2</a> interfaces, followed by using the MSAA (Microsoft&reg; Active Accessibility&reg;) interfaces. (In cases where the an application is known to have custom interfaces which provide information not supplied by <a class="el" href="interface_i_accessible2.html" title="This interface exposes the primary set of information about an IAccessible2 enabled accessible object...">IAccessible2</a> or MSAA, then those custom interfaces can be used.) <a class="el" href="protocol_the-p.html">The</a> AT can then, by default, support unknown IAccessible2/MSAA applications, without the application developers having to request AT vendors for support on an individual application by application basis.</p>
<p>When you have a reference to an IAccessible and require a reference to an <a class="el" href="interface_i_accessible2.html" title="This interface exposes the primary set of information about an IAccessible2 enabled accessible object...">IAccessible2</a> use QueryService as follows: </p><div class="fragment"><div class="line"><span class="comment">// pAcc is a reference to the accessible object&#39;s IAccessible interface. </span></div><div class="line">IServiceProvider *pService = <a class="code" href="_derived_data_2_web_kit_2_build_2_products_2_debug_2usr_2local_2include_2webrtc_2common__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; </div><div class="line"><a class="code" href="nightly-start_8php.html#a1017357584fb44ce29fae2f3f9ff286e">hr</a> = pAcc-&gt;QueryInterface(IID_IServiceProvider, (<span class="keywordtype">void</span> **)&amp;pService); </div><div class="line"><span class="keywordflow">if</span>(<a class="code" href="namespacecricket.html#acfec25bb1614ef57fe76a9f88b38b006afd9f6519d3f45276829fe74eb2c4bb85">SUCCEEDED</a>(<a class="code" href="nightly-start_8php.html#a1017357584fb44ce29fae2f3f9ff286e">hr</a>)) { </div><div class="line">  <a class="code" href="interface_i_accessible2.html">IAccessible2</a> *pIA2 = <a class="code" href="_derived_data_2_web_kit_2_build_2_products_2_debug_2usr_2local_2include_2webrtc_2common__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; </div><div class="line">  <a class="code" href="nightly-start_8php.html#a1017357584fb44ce29fae2f3f9ff286e">hr</a> = pService-&gt;QueryService(IID_IAccessible, IID_IAccessible2, (<span class="keywordtype">void</span>**)&amp;pIA2); </div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="namespacecricket.html#acfec25bb1614ef57fe76a9f88b38b006afd9f6519d3f45276829fe74eb2c4bb85">SUCCEEDED</a>(<a class="code" href="nightly-start_8php.html#a1017357584fb44ce29fae2f3f9ff286e">hr</a>) &amp;&amp; pIA2) { </div><div class="line">    <span class="comment">// The control supports IAccessible2. </span></div><div class="line">    <span class="comment">// pIA2 is the reference to the accessible object&#39;s IAccessible2 interface.</span></div><div class="line">  } </div><div class="line">} </div></div><!-- fragment --><h1><a class="anchor" id="_changingInterfaces"></a>
Changing between Accessible Interfaces</h1>
<p>Note that developers must always implement MSAA's IAccessible and, if needed, some of the interfaces in the set of <a class="el" href="interface_i_accessible2.html" title="This interface exposes the primary set of information about an IAccessible2 enabled accessible object...">IAccessible2</a> interfaces. Although the <a class="el" href="interface_i_accessible2.html" title="This interface exposes the primary set of information about an IAccessible2 enabled accessible object...">IAccessible2</a> IDL is coded such that <a class="el" href="interface_i_accessible2.html" title="This interface exposes the primary set of information about an IAccessible2 enabled accessible object...">IAccessible2</a> is a subclass of MSAA's IAccessible, none of MSAA's IAccessible methods are redefined by <a class="el" href="interface_i_accessible2.html" title="This interface exposes the primary set of information about an IAccessible2 enabled accessible object...">IAccessible2</a>.</p>
<p>QueryService must be used to switch from a reference to an MSAA IAccessible interface to another interface. This has been <a href="http://www.atia.org/files/public/Introducing_IAccessibleEx.doc">documented</a> and the pertinent facts have been extracted below:</p>
<dl class="section user"><dt></dt><dd>Why use QueryService instead of just using QueryInterface to get IAccessibleEx directly? <a class="el" href="protocol_the-p.html">The</a> reason is that since MSAA 2.0, clients don't talk to a server's IAccessible interface directly; instead they talk to an intermediate MSAA-provided wrapper that calls through to the original IAccessible. This wrapper provides services such as implementing IDispatch, supplying information from MSAA 2.0's Dynamic Annotation service, and scaling locations when running on Windows Vista with DPI scaling enabled. QueryService is the supported way to expose additional interfaces from an existing IAccessible and was originally used by MSHTML to expose IHTMLElement objects corresponding to IAccessibles. QueryService is often more convenient for servers to implement than QueryInterface because it does not have the same requirements for preserving object identity or symmetry/transitivity as QueryInterface, so QueryService allows servers to easily implement the interface on the same object or a separate object. <a class="el" href="protocol_the-p.html">The</a> latter is often hard to do with QueryInterface unless the original object supports aggregation.</dd></dl>
<p>Two related references in MSDN&reg; are: </p><ul>
<li><a href="http://msdn.microsoft.com/en-us/library/ms696078(VS.85).aspx">"Using QueryService to expose a native object model interface for an IAccessible object"</a> </li>
<li><a href="http://msdn.microsoft.com/en-us/library/ms528415.aspx#acc_obj">"Accessing the Internet Explorer Object Associated with an Accessible Object"</a></li>
</ul>
<p>Based on this information from Microsoft, QueryService must be used to switch back and forth between a reference to an MSAA IAccessible interface and any of the <a class="el" href="interface_i_accessible2.html" title="This interface exposes the primary set of information about an IAccessible2 enabled accessible object...">IAccessible2</a> interfaces.</p>
<p>Regarding switching between any of the <a class="el" href="interface_i_accessible2.html" title="This interface exposes the primary set of information about an IAccessible2 enabled accessible object...">IAccessible2</a> interfaces, applications implementing <a class="el" href="interface_i_accessible2.html" title="This interface exposes the primary set of information about an IAccessible2 enabled accessible object...">IAccessible2</a> should implement the <a class="el" href="interface_i_accessible2.html" title="This interface exposes the primary set of information about an IAccessible2 enabled accessible object...">IAccessible2</a> interfaces on a single object since ATs will be using QueryInterface to switch between the IAccessilbe2 interfaces. Implementing the <a class="el" href="interface_i_accessible2.html" title="This interface exposes the primary set of information about an IAccessible2 enabled accessible object...">IAccessible2</a> interfaces on separate objects would require the use of QueryService. There is one exception, <a class="el" href="interface_i_accessible_application.html" title="This interface gives access to the application&#39;s name and version information. ">IAccessibleApplication</a> can be implemented on a separate object so its common code doesn't have to be included in each accessible object. ATs should use QueryService to access <a class="el" href="interface_i_accessible_application.html" title="This interface gives access to the application&#39;s name and version information. ">IAccessibleApplication</a>.</p>
<h1><a class="anchor" id="_applicationInfo"></a>
Access to Information about the Application</h1>
<p>Servers implementing <a class="el" href="interface_i_accessible2.html" title="This interface exposes the primary set of information about an IAccessible2 enabled accessible object...">IAccessible2</a> should provide access to the <a class="el" href="interface_i_accessible_application.html" title="This interface gives access to the application&#39;s name and version information. ">IAccessibleApplication</a> interface via QueryService from any object so that ATs can easily determine specific information about the application such as its name or version.</p>
<h1><a class="anchor" id="_childIDs"></a>
Child IDs</h1>
<p><a class="el" href="protocol_the-p.html">The</a> <a class="el" href="interface_i_accessible2.html" title="This interface exposes the primary set of information about an IAccessible2 enabled accessible object...">IAccessible2</a> interfaces do not support child IDs, i.e. simple child elements. Full accessible objects must be created for each object that supports <a class="el" href="interface_i_accessible2.html" title="This interface exposes the primary set of information about an IAccessible2 enabled accessible object...">IAccessible2</a>. Therefore MSAA's get_accChild should never return a child ID (other than CHILDID_SELF) for an object that implements any of the <a class="el" href="interface_i_accessible2.html" title="This interface exposes the primary set of information about an IAccessible2 enabled accessible object...">IAccessible2</a> interfaces.</p>
<p>Microsoft's UI Automation specification has the same limitation and this was resolved in the UI Automation Express specification by adding IAccessibleEx::GetObjectForChild and IAccessibleEx::GetIAccessiblePair. These methods allow mapping back and forth between an IAccessibleEx and an {IAccessible, Child ID} pair. <a class="el" href="struct_a.html">A</a> future version of <a class="el" href="interface_i_accessible2.html" title="This interface exposes the primary set of information about an IAccessible2 enabled accessible object...">IAccessible2</a> may include similar methods to map back and forth between an <a class="el" href="interface_i_accessible2.html" title="This interface exposes the primary set of information about an IAccessible2 enabled accessible object...">IAccessible2</a> and an {IAccessible, Child ID} pair.</p>
<h1><a class="anchor" id="_variants"></a>
VARIANTs</h1>
<p>Some methods return a VARIANT. Implementers need to make sure that the return type is specified, i.e. VT_I4, VT_IDISPATCH, etc. <a class="el" href="protocol_the-p.html">The</a> methods that return VARIANTs are IAccessibleHyperlink::anchor, IAccessibleHyperlink::anchorTarget, IAccessibleValue::currentValue, IAccessibleValue::maximumValue, IAccessibleValue::minimumValue.</p>
<h1><a class="anchor" id="_iaaction-iahyperlink"></a>
IAccessibleHyperlink as subclass of IAccessibleAction</h1>
<p>In this version of the IDL, IAccessibleHyperlink is a subclass of IAccessibleAction. However, there is no practical need for that inheritance and in some cases, such as an image map of smart tags, it doesn't make sense because such an image map doesn't have actionable objects; it's the secondary smart tags that are actionable. As a result, implementations should not rely on the inheritance as it may be removed in a later version of the IDL.</p>
<h1><a class="anchor" id="_trademark"></a>
Trademark Attribution</h1>
<p><a class="el" href="protocol_the-p.html">The</a> names of actual companies and products mentioned herein may be the trademarks of their respective owners. In particular, Active Accessibility, Microsoft, MSDN, and Win32 are trademarks of the Microsoft group of companies in the U.S.A. and/or other countries. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
