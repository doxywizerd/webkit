<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>webkit: BoringSSL Style Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">webkit
   &#160;<span id="projectnumber">2cdf99a9e3038c7e01b3c37e8ad903ecbe5eecf1</span>
   </div>
   <div id="projectbrief">https://github.com/WebKit/webkit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">BoringSSL Style Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>BoringSSL usually follows the <a href="https://google.github.io/styleguide/cppguide.html">Google C++ style guide</a>, <a class="el" href="protocol_the-p.html">The</a> rest of this document describes differences and clarifications on top of the base guide.</p>
<h2>Legacy code</h2>
<p>As a derivative of OpenSSL, BoringSSL contains a lot of legacy code that does not follow this style guide. Particularly where public <a class="el" href="namespace_a_p_i.html">API</a> is concerned, balance consistency within a module with the benefits of a given rule. Module-wide deviations on naming should be respected while integer and return value conventions take precedence over consistency.</p>
<p>Modules from OpenSSL's legacy ASN.1 and X.509 stack are retained for compatibility and left largely unmodified. To ease importing patches from upstream, they match OpenSSL's new indentation style. For Emacs, <code>doc/openssl-c-indent.el</code> from OpenSSL may be helpful in this.</p>
<h2>Language</h2>
<p><a class="el" href="protocol_the-p.html">The</a> majority of the project is in <a class="el" href="class_c.html">C</a>, so C++-specific rules in the <a class="el" href="namespace_google.html">Google</a> style guide do not apply. Support for C99 features depends on our target platforms. Typically, Chromium's target MSVC is the most restrictive.</p>
<p>Variable declarations in the middle of a function or inside a <code>for</code> loop are allowed and preferred where possible. Note that the common <code>goto err</code> cleanup pattern requires lifting some variable declarations.</p>
<p>Comments should be <code>/* C-style */</code> for consistency.</p>
<p>When declaration pointer types, <code>*</code> should be placed next to the variable name, not the type. So </p><pre class="fragment">uint8_t *ptr;
</pre><p>not </p><pre class="fragment">uint8_t* ptr;
</pre><p>Rather than <code><a class="el" href="mbmalloc_8h.html#acf143577800376dd931c059ecc61ba06">malloc()</a></code> and <code><a class="el" href="mbmalloc_8h.html#a2c6efa7679f8cd9f61af96e105017560">free()</a></code>, use the wrappers <code><a class="el" href="mem_8h.html#a8de29bb2a7c9670fdd3f0ba1b0ce8e31">OPENSSL_malloc()</a></code> and <code><a class="el" href="mem_8h.html#a1d51116f9ce44c5cd2f981ca9ae64945">OPENSSL_free()</a></code>. Use the standard <a class="el" href="class_c.html">C</a> <code>assert()</code> function freely.</p>
<p>For new constants, prefer enums when the values are sequential and typed constants for flags. If adding values to an existing set of <code>#define</code>s, continue with <code>#define</code>.</p>
<h2>Formatting</h2>
<p>Single-statement blocks are not allowed. All conditions and loops must use braces: </p><pre class="fragment">if (foo) {
  do_something();
}
</pre><p>not </p><pre class="fragment">if (foo)
  do_something();
</pre><h2>Integers</h2>
<p>Prefer using explicitly-sized integers where appropriate rather than generic <a class="el" href="class_c.html">C</a> ones. For instance, to represent a byte, use <code>uint8_t</code>, not <code>unsigned char</code>. Likewise, represent a two-byte field as <code>uint16_t</code>, not <code>unsigned short</code>.</p>
<p>Sizes are represented as <code>size_t</code>.</p>
<p>Within a struct that is retained across the lifetime of an SSL connection, if bounds of a size are known and it's easy, use a smaller integer type like <code>uint8_t</code>. This is a "free" connection footprint optimization for servers. Don't make code significantly more complex for it, and do still check the bounds when passing in and out of the struct. This narrowing should not propagate to local variables and function parameters.</p>
<p>When doing arithmetic, account for overflow conditions.</p>
<p>Except with platform APIs, do not use <code>ssize_t</code>. MSVC lacks it, and prefer out-of-band error signaling for <code>size_t</code> (see Return values).</p>
<h2>Naming</h2>
<p>Follow <a class="el" href="namespace_google.html">Google</a> naming conventions in C++ files. In <a class="el" href="class_c.html">C</a> files, use the following naming conventions for consistency with existing OpenSSL and <a class="el" href="class_c.html">C</a> styles:</p>
<p>Define structs with typedef named <code>TYPE_NAME</code>. <a class="el" href="protocol_the-p.html">The</a> corresponding struct should be named <code>struct type_name_st</code>.</p>
<p>Name public functions as <code>MODULE_function_name</code>, unless the module already uses a different naming scheme for legacy reasons. <a class="el" href="protocol_the-p.html">The</a> module name should be a type name if the function is a method of a particular type.</p>
<p>Some types are allocated within the library while others are initialized into a struct allocated by the caller, often on the stack. Name these functions <code>TYPE_NAME_new</code>/<code>TYPE_NAME_free</code> and <code>TYPE_NAME_init</code>/<code>TYPE_NAME_cleanup</code>, respectively. All <code>TYPE_NAME_free</code> functions must do nothing on <code>NULL</code> input.</p>
<p>If a variable is the length of a pointer value, it has the suffix <code>_len</code>. An output parameter is named <code>out</code> or has an <code>out_</code> prefix. For instance, For instance: </p><pre class="fragment">uint8_t *out,
size_t *out_len,
const uint8_t *in,
size_t in_len,
</pre><p>Name public headers like <code>include/openssl/evp.h</code> with header guards like <code>OPENSSL_HEADER_EVP_H</code>. Name internal headers like <code>crypto/ec/internal.h</code> with header guards like <code>OPENSSL_HEADER_EC_INTERNAL_H</code>.</p>
<p>Name enums like <code>enum unix_hacker_t</code>. For instance: </p><pre class="fragment">enum should_free_handshake_buffer_t {
  free_handshake_buffer,
  dont_free_handshake_buffer,
};
</pre><h2>Return values</h2>
<p>As even <code>malloc</code> may fail in BoringSSL, the vast majority of functions will have a failure case. Functions should return <code>int</code> with one on success and zero on error. Do not overload the return value to both signal success/failure and output an integer. For example: </p><pre class="fragment">OPENSSL_EXPORT int CBS_get_u16(CBS *cbs, uint16_t *out);
</pre><p>If a function needs more than a true/false result code, define an enum rather than arbitrarily assigning meaning to int values.</p>
<p>If a function outputs a pointer to an object on success and there are no other outputs, return the pointer directly and <code>NULL</code> on error.</p>
<h2>Parameters</h2>
<p>Where not constrained by legacy code, parameter order should be:</p>
<ol type="1">
<li>context parameters</li>
<li>output parameters</li>
<li>input parameters</li>
</ol>
<p>For example, </p><pre class="fragment">/* CBB_add_asn sets |*out_contents| to a |CBB| into which the contents of an
 * ASN.1 object can be written. The |tag| argument will be used as the tag for
 * the object. It returns one on success or zero on error. */
OPENSSL_EXPORT int CBB_add_asn1(CBB *cbb, CBB *out_contents, unsigned tag);
</pre><h2>Documentation</h2>
<p>All public symbols must have a documentation comment in their header file. <a class="el" href="protocol_the-p.html">The</a> style is based on that of Go. <a class="el" href="protocol_the-p.html">The</a> first sentence begins with the symbol name, optionally prefixed with "A" or "An". Apart from the initial mention of symbol, references to other symbols or parameter names should be surrounded by |pipes|.</p>
<p>Documentation should be concise but completely describe the exposed behavior of the function. Pay special note to success/failure behaviors and caller obligations on object lifetimes. If this sacrifices conciseness, consider simplifying the function's behavior. </p><pre class="fragment">/* EVP_DigestVerifyUpdate appends |len| bytes from |data| to the data which
 * will be verified by |EVP_DigestVerifyFinal|. It returns one on success and
 * zero otherwise. */
OPENSSL_EXPORT int EVP_DigestVerifyUpdate(EVP_MD_CTX *ctx, const void *data,
                                          size_t len);
</pre><p>Explicitly mention any surprising edge cases or deviations from common return value patterns in legacy functions. </p><pre class="fragment">/* RSA_private_encrypt encrypts |flen| bytes from |from| with the private key in
 * |rsa| and writes the encrypted data to |to|. The |to| buffer must have at
 * least |RSA_size| bytes of space. It returns the number of bytes written, or
 * -1 on error. The |padding| argument must be one of the |RSA_*_PADDING|
 * values. If in doubt, |RSA_PKCS1_PADDING| is the most common.
 *
 * WARNING: this function is dangerous because it breaks the usual return value
 * convention. Use |RSA_sign_raw| instead. */
OPENSSL_EXPORT int RSA_private_encrypt(int flen, const uint8_t *from,
                                       uint8_t *to, RSA *rsa, int padding);
</pre><p><a class="el" href="interface_document.html">Document</a> private functions in their <code>internal.h</code> header or, if static, where defined. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
