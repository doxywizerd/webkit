<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>webkit: Build scripts that publish pre-compiled protoc artifacts</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">webkit
   &#160;<span id="projectnumber">2cdf99a9e3038c7e01b3c37e8ad903ecbe5eecf1</span>
   </div>
   <div id="projectbrief">https://github.com/WebKit/webkit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Build scripts that publish pre-compiled protoc artifacts </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><code>protoc</code> is the compiler for <code>.proto</code> files. It generates language bindings for the messages and/or RPC services from <code>.proto</code> files.</p>
<p>Because <code>protoc</code> is a native executable, the scripts under this directory build and publish a <code>protoc</code> executable (a.k.a. artifact) to Maven repositories. <a class="el" href="protocol_the-p.html">The</a> artifact can be used by build automation tools so that users would not need to compile and install <code>protoc</code> for their systems.</p>
<h2>Versioning</h2>
<p><a class="el" href="protocol_the-p.html">The</a> version of the <code>protoc</code> artifact must be the same as the version of the Protobuf project.</p>
<h2>Artifact name</h2>
<p><a class="el" href="protocol_the-p.html">The</a> name of a published <code>protoc</code> artifact is in the following format: <code>protoc-&lt;version&gt;-&lt;os&gt;-&lt;arch&gt;.exe</code>, e.g., <code>protoc-3.0.0-alpha-3-windows-x86_64.exe</code>.</p>
<h2>System requirement</h2>
<p>Install <a href="http://maven.apache.org/">Apache Maven</a> if you don't have it.</p>
<p><a class="el" href="protocol_the-p.html">The</a> scripts only work under Unix-like environments, e.g., Linux, MacOSX, and Cygwin or MinGW for Windows. Please see <code>README.md</code> of the Protobuf project for how to set up the build environment.</p>
<h2>To install artifacts locally</h2>
<p><a class="el" href="protocol_the-p.html">The</a> following command will install the <code>protoc</code> artifact to your local Maven repository. </p><div class="fragment"><div class="line">$ mvn install</div></div><!-- fragment --><h2>Cross-compilation</h2>
<p><a class="el" href="protocol_the-p.html">The</a> Maven script will try to detect the OS and the architecture from Java system properties. It's possible to build a protoc binary for an architecture that is different from what Java has detected, as long as you have the proper compilers installed.</p>
<p>You can override the Maven properties <code>os.detected.name</code> and <code>os.detected.arch</code> to force the script to generate binaries for a specific OS and/or architecture. Valid values are defined as the return values of <code>normalizeOs()</code> and <code>normalizeArch()</code> of <code>Detector</code> from <a href="https://github.com/trustin/os-maven-plugin/blob/master/src/main/java/kr/motd/maven/os/Detector.java">os-maven-plugin</a>. Frequently used values are:</p><ul>
<li><code>os.detected.name</code>: <code>linux</code>, <code>osx</code>, <code>windows</code>.</li>
<li><code>os.detected.arch</code>: <code>x86_32</code>, <code>x86_64</code></li>
</ul>
<p>For example, MingGW32 only ships with 32-bit compilers, but you can still build 32-bit protoc under 64-bit Windows, with the following command: </p><div class="fragment"><div class="line">$ mvn install -Dos.detected.arch=x86_32</div></div><!-- fragment --><h2>To push artifacts to Maven Central</h2>
<p>Before you can upload artifacts to Maven Central repository, make sure you have read <a href="http://central.sonatype.org/pages/apache-maven.html">this page</a> on how to configure GPG and Sonatype account.</p>
<p>You need to perform the deployment for every platform that you want to support. DO NOT close the staging repository until you have done the deployment for all platforms. Currently the following platforms are supported:</p><ul>
<li>Linux (x86_32 and x86_64)</li>
<li>Windows (x86_32 and x86_64) with<ul>
<li>Cygwin with MinGW compilers (both x86_32 and x86_64)</li>
<li>MSYS with MinGW32 (x86_32 only)</li>
</ul>
</li>
<li>MacOSX (x86_32 and x86_64)</li>
</ul>
<p>Use the following command to deploy artifacts for the host platform to a staging repository. </p><div class="fragment"><div class="line">$ mvn clean deploy -P release</div></div><!-- fragment --><p> It creates a new staging repository. Go to <a href="https://oss.sonatype.org/#stagingRepositories">https://oss.sonatype.org/#stagingRepositories</a> and find the repository, usually in the name like <code>comgoogle-123</code>.</p>
<p>You will want to run this command on a different platform. Remember, in subsequent deployments you will need to provide the repository name that you have found in the first deployment so that all artifacts go to the same repository: </p><div class="fragment"><div class="line">$ mvn clean deploy -P release -Dstaging.repository=comgoogle-123</div></div><!-- fragment --><p><a class="el" href="struct_a.html">A</a> 32-bit artifact can be deployed from a 64-bit host with <code>-Dos.detected.arch=x86_32</code></p>
<p>When you have done deployment for all platforms, go to <a href="https://oss.sonatype.org/#stagingRepositories,">https://oss.sonatype.org/#stagingRepositories,</a> verify that the staging repository has all the binaries, close and release this repository.</p>
<h3>Tips for deploying on Linux</h3>
<p>We build on Centos 6.6 to provide a good compatibility for not very new systems. We have provided a <code>Dockerfile</code> under this directory to build the environment. It has been tested with Docker 1.6.1.</p>
<p>To build a image: </p><div class="fragment"><div class="line">$ docker build -t protoc-artifacts .</div></div><!-- fragment --><p>To run the image: </p><div class="fragment"><div class="line">$ docker run -it --rm=true protoc-artifacts</div></div><!-- fragment --><p><a class="el" href="protocol_the-p.html">The</a> Protobuf repository has been cloned into <code>/protobuf</code>.</p>
<h3>Tips for deploying on Windows</h3>
<p>Under Windows the following error may occur: <code>gpg: cannot open tty `no tty': No such file or directory</code>. This can be fixed by configuring gpg through an active profile in <code>.m2\settings.xml</code> where also the Sonatype password is stored: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">settings</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">servers</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">server</span>&gt;</div><div class="line">      &lt;<span class="keywordtype">id</span>&gt;<span class="keyword">ossrh</span>&lt;/<span class="keywordtype">id</span>&gt;</div><div class="line">      &lt;<span class="keywordtype">username</span>&gt;[<span class="keyword">username</span>]&lt;/<span class="keywordtype">username</span>&gt;</div><div class="line">      &lt;<span class="keywordtype">password</span>&gt;[<span class="keyword">password</span>]&lt;/<span class="keywordtype">password</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">server</span>&gt;</div><div class="line">  &lt;/<span class="keywordtype">servers</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">profiles</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">profile</span>&gt;</div><div class="line">      &lt;<span class="keywordtype">id</span>&gt;<span class="keyword">gpg</span>&lt;/<span class="keywordtype">id</span>&gt;</div><div class="line">      &lt;<span class="keywordtype">properties</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">gpg.executable</span>&gt;<span class="keyword">gpg</span>&lt;/<span class="keywordtype">gpg.executable</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">gpg.passphrase</span>&gt;[<span class="keyword">password</span>]&lt;/<span class="keywordtype">gpg.passphrase</span>&gt;</div><div class="line">      &lt;/<span class="keywordtype">properties</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">profile</span>&gt;</div><div class="line">  &lt;/<span class="keywordtype">profiles</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">activeProfiles</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">activeProfile</span>&gt;<span class="keyword">gpg</span>&lt;/<span class="keywordtype">activeProfile</span>&gt;</div><div class="line">  &lt;/<span class="keywordtype">activeProfiles</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">settings</span>&gt;</div></div><!-- fragment --><h3>Tested build environments</h3>
<p>We have successfully built artifacts on the following environments:</p><ul>
<li>Linux x86_32 and x86_64:<ul>
<li>Centos 6.6 (within Docker 1.6.1)</li>
<li>Ubuntu 14.04.2 64-bit</li>
</ul>
</li>
<li>Windows x86_32: MSYS with <code>mingw32-gcc-g++ 4.8.1-4</code> on Windows 7 64-bit</li>
<li>Windows x86_64: Cygwin64 with <code>mingw64-x86_64-gcc-g++ 4.8.3-1</code> on Windows 7 64-bit</li>
<li>Mac OS X x86_32 and x86_64: Mac OS X 10.9.5 </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
